// gcc -o lisa lisa.c -m32 -mpreferred-stack-boundary=2
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>

char *inp, *pass;
int pfd;

void lisa();

void fail(void *buf)
{
  puts("Ugh! You kiss your mother with that mouth?");
  read(0, buf, 0x1Du);
  return;
}

int doStrcmp(char *s1, char *s2)
{
  return strcmp(s1, s2) == 0;
}

void checkPass()
{
  char buf[0x18]; // [sp+0h] [bp-18h]@3

  if ( doStrcmp(inp, pass) )
    lisa();
  else
    fail(buf);
  return;
}

void lisa()
{
  puts("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!>''''''<!!!!!!!!!!!!!!!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!!!!!!!!!!!!!'''''`             ``'!!!!!!!!!!!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!!!!!!!!!''`          .....         `'!!!!!!!!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!!!!!!'`      .      :::::'            `'!!!!!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!!!!'     .   '     .::::'                `!!!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!!'      :          `````                   `!!!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!!        .,cchcccccc,,.                       `!!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!!     .-\"?$$$$$$$$$$$$$$c,                      `!!!!!!!!!!!");
  puts("!!!!!!!!!!!!!!    ,ccc$$$$$$$$$$$$$$$$$$$,                     `!!!!!!!!!!");
  puts("!!!!!!!!!!!!!    z$$$$$$$$$$$$$$$$$$$$$$$$;.                    `!!!!!!!!!");
  puts("!!!!!!!!!!!!    <$$$$$$$$$$$$$$$$$$$$$$$$$$:.                    `!!!!!!!!");
  puts("!!!!!!!!!!!     $$$$$$$$$$$$$$$$$$$$$$$$$$$h;:.                   !!!!!!!!");
  puts("!!!!!!!!!!'     $$$$$$$$$$$$$$$$$$$$$$$$$$$$$h;.                   !!!!!!!");
  puts("!!!!!!!!!'     <$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$                   !!!!!!!");
  puts("!!!!!!!!'      `$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$F                   `!!!!!!");
  puts("!!!!!!!!        c$$$$???$$$$$$$P\"\"  \"\"\"??????\"                      !!!!!!");
  puts("!!!!!!!         `\"\" .,.. \"$$$$F    .,zcr                            !!!!!!");
  printf("\t\t\t\t");
  system("/bin/cat ./flag");
  puts("!!!!!!!!        <. $$c= <$d$$$   <$$$$=-=+\"$$$$$$$                  !!!!!!");
  puts("!!!!!!!         d$$$hcccd$$$$$   d$$$hcccd$$$$$$$F                  `!!!!!");
  puts("!!!!!!         ,$$$$$$$$$$$$$$h d$$$$$$$$$$$$$$$$                   `!!!!!");
  puts("!!!!!          `$$$$$$$$$$$$$$$<$$$$$$$$$$$$$$$$'                    !!!!!");
  puts("!!!!!          `$$$$$$$$$$$$$$$$\"$$$$$$$$$$$$$P>                     !!!!!");
  puts("!!!!!           ?$$$$$$$$$$$$??$c`$$$$$$$$$$$?>'                     `!!!!");
  puts("!!!!!           `?$$$$$$I7?\"\"    ,$$$$$$$$$?>>'                       !!!!");
  puts("!!!!!.           <<?$$$$$$c.    ,d$$?$$$$$F>>''                       `!!!");
  puts("!!!!!!            <i?$P\"??$$r--\"?\"\"  ,$$$$h;>''                       `!!!");
  puts("!!!!!!             $$$hccccccccc= cc$$$$$$$>>'                         !!!");
  puts("!!!!!              `?$$$$$$F\"\"\"\"  `\"$$$$$>>>''                         `!!");
  puts("!!!!!                \"?$$$$$cccccc$$$$??>>>>'                           !!");
  puts("!!!!>                  \"$$$$$$$$$$$$$F>>>>''                            `!");
  puts("!!!!!                    \"$$$$$$$$???>'''                                !");
  puts("!!!!!>                     `\"\"\"\"\"                                        `");
  puts("!!!!!!;                       .                                          `");
  puts("!!!!!!!                       ?h.");
  puts("!!!!!!!!                       $$c,");
  puts("!!!!!!!!>                      ?$$$h.              .,c");
  puts("!!!!!!!!!                       $$$$$$$$$hc,.,,cc$$$$$");
  puts("!!!!!!!!!                  .,zcc$$$$$$$$$$$$$$$$$$$$$$");
  puts("!!!!!!!!!               .z$$$$$$$$$$$$$$$$$$$$$$$$$$$$");
  puts("!!!!!!!!!             ,d$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$          .");
  puts("!!!!!!!!!           ,d$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$         !!");
  puts("!!!!!!!!!         ,d$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$        ,!'");
  puts("!!!!!!!!>        c$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$.       !'");
  puts("!!!!!!''       ,d$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$>       '");
  puts("!!!''         z$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$>");
  puts("!'           ,$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$>             ..");
  puts("            z$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$'           ;!!!!''`");
  puts("            $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$F       ,;;!'`'  .''");
  puts("           <$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$>    ,;'`'  ,;");
  puts("           `$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$F   -'   ,;!!'");
  puts("            \"?$$$$$$$$$$?$$$$$$$$$$$$$$$$$$$$$$$$$$F     .<!!!'''       <!");
  puts("         !>    \"\"??$$$?C3$$$$$$$$$$$$$$$$$$$$$$$$\"\"     ;!'''          !!!");
  puts("       ;!!!!;,      `\"''\"\"????$$$$$$$$$$$$$$$$\"\"   ,;-''               ',!");
  puts("      ;!!!!<!!!; .                `\"\"\"\"\"\"\"\"\"\"\"    `'                  ' '");
  puts("      !!!! ;!!! ;!!!!>;,;, ..                  ' .                   '  '");
  puts("     !!' ,;!!! ;'`!!!!!!!!;!!!!!;  .        >' .''                 ;");
  puts("    !!' ;!!'!';! !! !!!!!!!!!!!!!  '         -'");
  puts("   <!!  !! `!;! `!' !!!!!!!!!!<!       .");
  puts("   `!  ;!  ;!!! <' <!!!! `!!! <       /");
  puts("  `;   !>  <!! ;'  !!!!'  !!';!     ;'");
  puts("   !   !   !!! !   `!!!  ;!! !      '  '");
  puts("  ;   `!  `!! ,'    !'   ;!'");
  puts("      '   /`! !    <     !! <      '");
  puts("           / ;!        >;! ;>");
  puts("             !'       ; !! '");
  puts("          ' ;!        > ! '");
  puts("            '");
  return;
}

int main()
{
  char s[0x30]; // [sp+0h] [bp-34h]@1

  setvbuf(stdout, NULL, _IONBF, 0x14u);
  setvbuf(stdin, NULL, _IONBF, 0x14u);
  memset(&s, 0, 0x30u);
  pass = malloc(0x2Bu);
  printf("Here's your share: %p\n", pass);
  puts("What? The Mona Lisa!\nLook, if you want somethin' from me, I'm gonna need somethin' from you alright...");
  read(0, s, 0x30u);
  inp = s;
  pfd = open("./password", 0);
  read(pfd, pass, 0x2Bu);
  checkPass();
  return 0;
}
